<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariate Statistical Analysis • MetaboMate</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate Statistical Analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-78685833-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-78685833-2');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MetaboMate</a>
        <span class="label label-info" data-toggle="tooltip" data-placement="bottom" title="Package in development">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MetaboMate.html">Getting started</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Imps.html">Data Import and Pre-processing</a>
    </li>
    <li>
      <a href="../articles/MVA.html">Multivariate Statistical Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tkimhofer/MetaboMate">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/torben-kimhofer-6337a725/">
    <span class="fa fa-linkedin fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/torben364">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Multivariate Statistical Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tkimhofer/MetaboMate/blob/master/vignettes/MVA.Rmd"><code>vignettes/MVA.Rmd</code></a></small>
      <div class="hidden name"><code>MVA.Rmd</code></div>

    </div>

    
    
<p>This vignette documents a typical multivariate statistical analysis workflow for NMR-based metabolic profilig using the <em>MetaboMate</em> R package. Example data represent Proton NMR spectra of murine urine samples collected before and after bariatric or sham surgery<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. Data have been pre-processed with <em>MetboMate</em> functions including spectral calibration, excision of chemical shift regions representing noise or unwanted signals and normalisation to account for different sample dilutions. Please see <em>Data Preprocessing</em> vignette for further information on data pre-processing.</p>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>I recommend to install RStudio. RStudio is an open-source integrated development environment for R, which includes a code editor that highlights syntax, enables quick and easy access to help pages, improves workspace management and offers various tools for plotting, history and debugging. Simply put, it makes working with R a lot more efficient.</p>
<p>Let’s get started with the analysis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">153</span>)

<span class="co"># Load package</span>
<span class="kw">library</span>(MetaboMate)</code></pre></div>
</div>
<div id="loading-example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-example-data" class="anchor"></a>Loading example data</h2>
<p>First, let’s import the bariatric surgery data with the following R commands.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load data</span>
<span class="kw">data</span>(bariatric)

<span class="co"># Declare variables</span>
X.pqn&lt;-bariatric<span class="op">$</span>X.pqn <span class="co"># NMR matrix</span>
ppm&lt;-bariatric<span class="op">$</span>ppm     <span class="co"># ppm vector</span>
meta&lt;-bariatric<span class="op">$</span>meta   <span class="co"># Metadata</span>
an&lt;-bariatric<span class="op">$</span>an       <span class="co"># Sample annotation</span></code></pre></div>
<p>For multivariate analysis the following variables should be in the R workspace:</p>
<ul>
<li>
<em>X.pqn</em> - preprocessed NMR data matrix, with rows representing spectra and columns ppm variables</li>
<li>
<em>ppm</em> - ppm vector, its length equals to the number of columns of X.pqn</li>
<li>
<em>an</em> - Sample annotation</li>
<li>
<em>meta</em> - Spectrometer metadata (this is not essential but useful for this tutorial)</li>
</ul>
</div>
<div id="visual-inspection-of-the-nmr-data" class="section level2">
<h2 class="hasAnchor">
<a href="#visual-inspection-of-the-nmr-data" class="anchor"></a>Visual inspection of the NMR data</h2>
<p>Let’s start with a visual inspection of the pre-processed NMR spectra using the <strong>matspec()</strong> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualise first ten spectra</span>
<span class="kw"><a href="../reference/matspec.html">matspec</a></span>(ppm, X.pqn[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,], <span class="dt">shift =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>))</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-3-1.png" width="691.2"></p>
<p>The pre-processed specra range from 0.5 to 9.5 ppm. If you have some experience in NMR spectroscopy you might suspect some unusual (and interesting) chemical shifts in the above plot. Most of these signals are endogenous, some are induced by the surgical procedure and others are clearly of microbial origin. We will find out more about this in the <strong>Metabolite Identification</strong> vignette of <em>MetaboMate</em> (currently work in progress).</p>
</div>
<div id="unsupervised-multivariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#unsupervised-multivariate-analysis" class="anchor"></a>Unsupervised Multivariate Analysis</h2>
<p>Let’s start with an exploratory analysis approach using Principal Component Analysis (PCA). This projection method summarises the data by weighting and linearly combining the orginal variables, to derive a latent (in the sense of unobserved) factor, so called principal component (PC). A PC is basically a new coordinate axis that is a weighted composite of the original variables. The weighting of each original variable is mainly based on its variation across samples and collinear variables have similar weightings. Usually, more than one principal component are calculated, and while each original variable is represented in each component, their weightings (also called loadings) change and are orthogonal (unrelated) to each other. In metabonomics, spectroscopic data are usually highly dimensional and collinear, and PCA allows to become a fairly good overview of the main sources of variation in the data by looking at the first few PCA components.</p>
<p>Calculating a PCA model can be achieved with the <strong>pca()</strong> function. Its input arguments are the pre-processed NMR matrix (<em>X=X.pqn</em>), information on how many prinicipal components should be fitted (<em>pc=2</em>) and centering and scaling parameters. Here the data will be unit variance scaled (<em>scale=“UV”</em>) and mean centered (<em>center=TRUE</em>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Perform PCA</span>
pca.model=<span class="kw"><a href="../reference/pca.html">pca</a></span>(<span class="dt">X=</span>X.pqn, <span class="dt">pc=</span><span class="dv">2</span>, <span class="dt">scale=</span><span class="st">'UV'</span>, <span class="dt">center=</span><span class="ot">TRUE</span>)
<span class="co">#&gt; iterations: 15</span>
<span class="co">#&gt; iterations: 30</span>
<span class="co">#&gt; [1] 67  2</span>
<span class="co">#&gt; [1] 56357     2</span></code></pre></div>
<p>Plotting PCA scores can be achieved with the <strong>plotscores()</strong> function. The minimum input arguments are a <em>PCA_Metabomate</em> object (<em>model=pca.model</em>, this is produced by the <strong>pca()</strong> call), the axis definition (<em>pc=c(1,2)</em>) and a list object (<em>an</em>) with its first element specifying the colouring.</p>
<p>Here we colour according to the performed surgical procedure which can be either none (Pre-op), Roux-en-Y gastric bypass (RYGB, a specific type of bariatic surgery) or Sham<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. The latter is really a control group that was included to account for incidential effects induced by the anesthesia, incision, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot PCA results: scores of the first two components</span>
<span class="kw"><a href="../reference/plotscores.html">plotscores</a></span>(<span class="dt">model=</span>pca.model, <span class="dt">pc=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">an=</span><span class="kw">list</span>(<span class="dt">Surgery=</span>an<span class="op">$</span>Class), <span class="dt">title=</span><span class="st">'PCA - Scores plot'</span>)</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>The scatterplot above shows PCA scores of the first two principal components (PC 1 and PC2) plotted against each other. In the scores plot, every point represents an NMR spectrum of a urine sample. The axis labels in parenthesis describe the amount of variation that is modelled by the repsective principal component, relative to the total amount of variablity in the data (this is also termed R<sup>2</sup>). The ellipse is the Hotelling’s T<sup>2</sup> which is a multivariate generalisation of a 95% confidence interval that can be used to spot outlier samples.</p>
<p>Additional graphics parameters can be passed on to <strong>plotscores()</strong>. For example, point shape and labels are specified as elements two and three of the <em>an</em> list argument, repsectively. See the following code for an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define scores that should be labelled</span>
idx&lt;-<span class="kw">which</span>(pca.model<span class="op">@</span>t[,<span class="dv">2</span>]<span class="op">&gt;</span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>an<span class="op">$</span>Class<span class="op">==</span><span class="st">'RYGB'</span>) <span class="co"># PC 2 scores above 20 and in group RYGB</span>

<span class="co"># construct label vector with mouse IDs</span>
outliers&lt;-<span class="kw">rep</span>(<span class="st">''</span>, <span class="kw">nrow</span>(an))
outliers[idx]&lt;-an<span class="op">$</span>ID[idx]

<span class="co"># Plot PCA scores, colour according to class, point shape according to time of sample collection and label outliers</span>
<span class="kw"><a href="../reference/plotscores.html">plotscores</a></span>(<span class="dt">model=</span>pca.model, <span class="dt">pc=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">an=</span><span class="kw">list</span>(
  <span class="dt">Class=</span>an<span class="op">$</span>Class,         <span class="co"># point colour</span>
  <span class="dt">Timepoint=</span>an<span class="op">$</span>Timepoint, <span class="co"># point shape</span>
  <span class="dt">ID=</span>outliers),           <span class="co"># point label</span>
  <span class="dt">title=</span><span class="st">'PCA - Scores plot'</span>)</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>We can visualise PCA loadings, these are the original the weightings on each PC, with the <strong>plotload()</strong> function. The funtion’s input arguments are the <em>PCA_MetaboMate</em> model, the NMR matrix &amp; ppm vector and the number of the PC to be visualised. In the example below, PCA loadings of the second principal component and within the chemical shift region of 6 - 9 ppm are visualised.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot PCA loadings</span>
<span class="kw"><a href="../reference/plotload.html">plotload</a></span>(pca.model, X.pqn, ppm, <span class="dt">pc=</span><span class="dv">2</span>, <span class="dt">shift=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">9</span>))</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-7-1.png" width="691.2"></p>
<p>The plot above is a statistical reconstruction of PCA variable loadings while at the same time resembling an NMR spectrum. The x axis describes the chemical shift of each variable in ppm, just like in an ordinary NMR spectrum, the y axis is the covariance of the PCA scores and original variables (indicating the peak magnitude and positive or negative model loadings), and the colour represents the importance of each variable for the component. Variables coloured towards the red colour spectrum are characteristic for spectra with postive (negative) scores when these point up (down) in the loadings plot.</p>
</div>
<div id="supervised-multivariate-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#supervised-multivariate-analysis" class="anchor"></a>Supervised Multivariate Analysis</h2>
<p>Although a clustering trend according to surgery type is visible in PCA scores plot, PCA is an unsupervised analysis method meaning it is not designed to optimise the separation of groups or regress against numeric variables. This is why we apply a supervised analysis method. Well-known in the field of metabolic phenotyping is the Partial Least Squares (PLS) method and its extensions, such as Orthogonal-Projections to Latent Structures, mostly known as <strong>Orthogonal Partial Least Squares (O-PLS)</strong>.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<div id="o-pls-model-training-and-statistical-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#o-pls-model-training-and-statistical-validation" class="anchor"></a>O-PLS model training and statistical validation</h3>
<p>Here we calculate an O-PLS model by calling the function <strong>olps()</strong>. Its minimum input arguments are X and Y, representing the NMR matrix and the response/outcome variable(s) (here: the surgical procedure), respectively. The <em>opls</em> function uses statsical resampling techniques to determine the optimal number of orthogonal components and returns the model as an <em>OPLS_Metabomate</em> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Exclude pre-op group</span>
idx=an<span class="op">$</span>Class<span class="op">!=</span><span class="st">'Pre-op'</span>
X=X.pqn[idx,]
Y=an<span class="op">$</span>Class[idx]

<span class="co"># Train O-PLS model</span>
opls.model=<span class="kw"><a href="../reference/opls.html">opls</a></span>(X,Y)
<span class="co">#&gt; Preparing data ... done.</span>
<span class="co">#&gt; Performing OPLS-DA ... done.</span>
<span class="co">#&gt; A model with 1 predictive and 1 orthogonal component(s) was fitted.</span></code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-8-1.png" width="691.2"></p>
<p>The model summary plot above describes the O-PLS parameters, with each set of bars corresponding to one fitted predictive and the specied number of orthogonal compononents. As you can see, the final model comprises one predictive and one orthogonal components (labelled 1+1). The last set of bars on the right-hand side of the plot (increased transparency) correspond to a model with 1 predictive and 2 orthogonal components (so one orthogonal component more than found appropriate). This information is included for comparative purposes and for the evaluation of the automatic stop criteria.</p>
<p>The model summary can also be returned as a table with the following command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">opls.model<span class="op">@</span>summary</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">R2X</th>
<th align="right">R2Y</th>
<th align="right">Q2</th>
<th align="right">AUROC</th>
</tr></thead>
<tbody><tr class="odd">
<td>PC_o 1</td>
<td align="right">0.16</td>
<td align="right">0.96</td>
<td align="right">0.88</td>
<td align="right">1</td>
</tr></tbody>
</table>
<p>R2X and R2Y describe how much variation the model describes in X and Y space, respecitvely. These indices range from 0 (no explanatory power) up to 1 (all variation is explained by the model). A high R2Y is desirable, indicating the O-PLS model explains much of the outcome variable.</p>
<p>The indices Q2 and AUROC_cv are calculated using statistical validation techniques and therefore, are estimates of how well the model generalise to new, independent data sets. Low values indicated that the model is overfitted (not desired), high values (max value for both is 1) are a good indicator for statistically robust O-PLS models.</p>
<p><strong>The Q2 is designed for regression tasks (numeric <em>Y</em> variable) and the AUROC_cv is designed for classification tasks (categorical <em>Y</em> variable).</strong> An AUROC exceeding 0.9 is often considered as excellent, a value of 0.8-0.9 as good, 0.7-0.8 as fair and below 0.7 as poor or failing to accurately define class memberships.</p>
</div>
<div id="distance-to-the-model-in-x-space" class="section level3">
<h3 class="hasAnchor">
<a href="#distance-to-the-model-in-x-space" class="anchor"></a>Distance to the Model in <em>X</em> Space</h3>
<p>The distance to the model in X space (DModX) is a dianostic measure to spot model outliers. The variable <em>X</em> refers to the independent variables, in this case the NMR matrix. We can access the DModX by calling the <strong>dmodx()</strong> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distX=<span class="kw"><a href="../reference/dmodx.html">dmodx</a></span>(<span class="dt">model=</span>opls.model, <span class="dt">plot=</span>T)</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-11-1.png" width="691.2"></p>
<p>In the plot above each point represents a sample and the dotted horizontal line represents a 95% confidence interval. This threshold is specific for a particular model and varies for different OPLS models. Samples exceeding the confidence line are considered as moderate outliers. In particular if the DModX plot shows any patterns a further investigation should be untertaken. The <em>distX</em> variable in the above code snippet is a dataframe of DModX values which can be used for further instpections.</p>
</div>
</div>
<div id="visualisation-of-o-pls-scores-and-loadings" class="section level2">
<h2 class="hasAnchor">
<a href="#visualisation-of-o-pls-scores-and-loadings" class="anchor"></a>Visualisation of O-PLS Scores and Loadings</h2>
<p>O-PLS model results are visualised in the scores plot, where the x-axis represents the predictive component and the y-axis an orthogonal component. The function <strong>plotscores()</strong> can be used for this taks (see section of PCA scores for function input arguments). An additionall input argument is whether cross-validated (CV) scores should be plotted or not. CV scores are derived withing the internal model validation procedure and are considered as statistically robust. See the following code for an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot OPLS scores</span>
<span class="kw"><a href="../reference/plotscores.html">plotscores</a></span>(<span class="dt">model=</span>opls.model, <span class="dt">pc=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">an=</span><span class="kw">list</span>(
  <span class="dt">Surgery=</span>an<span class="op">$</span>Class[idx],          <span class="co"># colouring according to surgery type</span>
  <span class="dt">Timepoint=</span>an<span class="op">$</span>Timepoint[idx]),   <span class="co"># linetype according to timepoint</span>
  <span class="dt">title=</span><span class="st">'OPLS - Scores plot'</span>,     <span class="co"># plot title</span>
  <span class="dt">cv.scores =</span> T)                  <span class="co"># visualise cross-validated scores</span></code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>The resuling OPLS CV scores plot shows a perfect separation of both surgery types, with all predictive power focussed on the x-axis (that is characteristic for O-PLS, compared to PLS).</p>
<p>The orthogonal component (y-axis) is - in the mathematical sense - unrelated to the outcome variable <em>Y</em>. In some cases, its interpretation can give some insights about the study samples. In the present case, the first orthogonal O-PLS component is associated with different urine dilutions and effects resulting from spectral normalisation, which was part of the data pre-processing pipeline.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotscores.html">plotscores</a></span>(opls.model, <span class="dt">pc=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">an=</span><span class="kw">list</span>(
  <span class="dt">Dilution=</span><span class="kw">log10</span>(meta<span class="op">$</span>dilF.pqn[idx])), 
  <span class="dt">title=</span><span class="st">'OPLS - Scores plot'</span>, <span class="dt">cv.scores =</span> F)</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>The variable influence on the predictive component can be visualised with the <strong>plotload()</strong> function which plots a single O-PLS model line plot (see PCA section).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotload.html">plotload</a></span>(opls.model, X, ppm, <span class="dt">type=</span><span class="st">'Reconstruction'</span>, <span class="dt">title =</span> <span class="st">'OPLS Loadings - Statistical Reconstruction'</span>, <span class="dt">shift=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">9.5</span>))</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-14-1.png" width="691.2"></p>
<p>The function’s input argument <em>type</em> allows different visualisations of the model loadings, that is either a statistical reconstruction using covariances or back-scaled loadings. For details on both of these methods see <em>help(plotload)</em> or the original publication by Cloarec <em>et al.</em>.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<p>The O-PLS loadings plot shown above highlights signals that are systematically different between the RYGB and Sham control group. In many cases, it is helpful to compare the O-PLS model loadings with spectra within certain chemical shift regions. The function <strong>specload1()</strong> can be used for this task. From the loadings plot above we can see that the signals within the region of 7.45 - 7.5 ppm has a high model importance, so let’s have a closer look at this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/specload1.html">specload1</a></span>(<span class="dt">model=</span>opls.model, <span class="dt">X=</span>X, ppm, <span class="dt">shift=</span><span class="kw">c</span>(<span class="fl">7.3</span>,<span class="fl">7.45</span>), <span class="dt">an=</span><span class="kw">list</span>(
  <span class="dt">facet=</span><span class="st">'All Spectra'</span>, 
  <span class="dt">Surgery=</span>an<span class="op">$</span>Class[idx]), 
  <span class="dt">type=</span><span class="st">'backscaled'</span>, <span class="dt">alp =</span> <span class="fl">0.2</span>, <span class="dt">title =</span> <span class="st">'Overlayed Spectra with Backscaled Loadings'</span>)</code></pre></div>
<p><img src="MVA_files/figure-html/unnamed-chunk-15-1.png" width="691.2"></p>
<p>The colour gradient-filled line located in the upper plot area shows the OPLS model loadings (in this case: backscaled method). Plotted below are overlayed NMR spectra where the colour represents group membership. It is easy to see that there are group-related intensity differences for two tripletts centered around 7.365 and 7.425 ppm, with on average lower intensities in the Sham group. Further information these signals will be given in the <strong>Metabolite Indeticiation</strong> vignettte of the <em>MetaboMate</em> package.</p>
</div>
<div id="summary-and-further-steps" class="section level1">
<h1 class="hasAnchor">
<a href="#summary-and-further-steps" class="anchor"></a>Summary and further steps</h1>
<p>This vignette illustrated multivariate statistical analysis of NMR-based metabolic phenotyping data with PCA and O-PLS using the <em>MetaboMate</em> package. Once a statistically robust OPLS model was established, information on variable importance was extracted using different loadings visualisations. The next step is the identification of signals with high model importance. Please see <strong>Metabolite Identification</strong> vignette for more information on this.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Li, Jia V., <em>et al.</em> (2011) Metabolic surgery profoundly influences gut microbial-host metabolic cross-talk. <em>Gut</em>. 60.9, 1214-1223.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>In a sham surgery an operation is performed but the surgeon omitts the intended therapeutic procedure.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Trygg, J., <em>et al.</em> (2002). Orthogonal projections to latent structures (O-PLS). <em>Journal of Chemometrics</em>, 16.3, 119-28.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Cloared, O., <em>et al.</em> (2005). Evaluation of the Orthogonal Projection on Latent Structure Model Limitations Caused by Chemical Shift Variability and Improved Visualization of Biomarker Changes in 1H NMR Spectroscopic Metabonomic Studies. <em>Analytical Chemistry</em>. 77.2, 517-26.<a href="#fnref4">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#loading-example-data">Loading example data</a></li>
      <li><a href="#visual-inspection-of-the-nmr-data">Visual inspection of the NMR data</a></li>
      <li><a href="#unsupervised-multivariate-analysis">Unsupervised Multivariate Analysis</a></li>
      <li><a href="#supervised-multivariate-analysis">Supervised Multivariate Analysis</a></li>
      <li><a href="#visualisation-of-o-pls-scores-and-loadings">Visualisation of O-PLS Scores and Loadings</a></li>
      <li><a href="#summary-and-further-steps">Summary and further steps</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://tkimhofer.com">Torben Kimhofer</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
